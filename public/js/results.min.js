"use strict";const resultElems=Array.from(document.getElementsByClassName("result")),timetable=document.getElementById("timetable");function renderTimetable(ev,elem,index){elem.classList.add("active"),resultElems.forEach(elem2=>{elem!==elem2&&elem2.classList.remove("active")});let timetableHtml='<div class="timeTableLine_header">\n        <div class="driver">\n            Driver\n        </div>\n        <div class="car">\n            Car\n        </div>\n        <div class="timing">\n            <div>Best</div>\n            <div>Last</div>\n            <div>Avg</div>\n            <div>Total</div>\n        </div>\n    </div>';results[index].sessionResult.leaderBoardLines.forEach((line,position)=>{const lapsTimesByDriver=results[index].laps.filter(elem=>elem.carId===line.car.carId).map(lap=>lap.laptime),avgLap=lapsTimesByDriver.length?lapsTimesByDriver.reduce((sum,val)=>sum+val,0)/lapsTimesByDriver.length:null;timetableHtml+=`<div class="timeTableLine${line.timing.totalTime<=line.timing.bestLap?" noValidLap":""}" data-carId="${line.car.carId}" data-position="${position}">\n                <div class="driver">\n                    <div class="position">${position+1}</div>\n                    <div class="shortName" title="${line.currentDriver.firstName} ${line.currentDriver.lastName}">${line.currentDriver.shortName}</div>\n                </div>\n                <div class="car">\n                    <div class="raceNumber">${line.car.raceNumber}</div>\n                    <div class="carModel">${basics.cars.find(car=>car.id===line.car.carModel).name}</div>\n                </div>\n                <div class="timing">\n                    <div class="${0===position?" bestLapAll":"bestLap"}" title="Best laptime">${getTime(line.timing.bestLap)}</div>\n                    <div class="lastLap${line.timing.bestLap===line.timing.lastLap?" bestLap":""}" title="Last laptime">${getTime(line.timing.lastLap)}</div>\n                    <div class="avgLap" title="Average laptime">${getTime(avgLap)}</div>\n                    <div class="totalTime" title="Total time">${getTime(line.timing.totalTime)}</div>\n                </div>\n            </div>`}),timetable.innerHTML=timetableHtml,Array.from(timetable.querySelectorAll(".timeTableLine:not(.noValidLap)")).forEach(elem=>elem.addEventListener("click",ev=>renderLaps(ev,elem,index,timetable))),timetable.scrollIntoView({behavior:"smooth"})}function renderLaps(ev,elem,index,timetable){const carId=parseInt(elem.getAttribute("data-carId")),position=parseInt(elem.getAttribute("data-position")),oldLapsElem=document.querySelector(`#laps_${carId}.laps`);if(oldLapsElem)return void oldLapsElem.remove();const lapsElem=document.createElement("div");lapsElem.className="laps",lapsElem.id="laps_"+carId;let lapTableHtml='<div class="lapTableLine_header">\n        <div>\n            Lap\n        </div>\n        <div>\n            Laptime\n        </div>\n        <div class="splits">\n            <div>S1</div>\n            <div>S2</div>\n            <div>S3</div>\n        </div>\n    </div>';const eventResults=results[index],leaderBoardLines=eventResults.sessionResult.leaderBoardLines,lapsByDriver=eventResults.laps.filter(elem=>elem.carId===carId),bestLap=leaderBoardLines[position].timing.bestLap,bestLapAll=Math.min(...eventResults.laps.filter(lap=>lap.isValidForBest).map(lap=>lap.laptime)),bestFirstSplit=Math.min(...lapsByDriver.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[0])),bestFirstSplitAll=Math.min(...eventResults.laps.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[0])),bestSecondSplit=Math.min(...lapsByDriver.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[1])),bestSecondSplitAll=Math.min(...eventResults.laps.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[1])),bestThirdSplit=Math.min(...lapsByDriver.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[2])),bestThirdSplitAll=Math.min(...eventResults.laps.filter(lap=>lap.isValidForBest).map(lap=>lap.splits[2]));lapsByDriver.forEach((lap,number)=>{const laptimeAddClass=lap.laptime===bestLapAll?"bestLapAll":lap.laptime===bestLap?"bestLap":"",firstSplitAddClass=lap.splits[0]===bestFirstSplitAll?"bestLapAll":lap.splits[0]===bestFirstSplit?"bestLap":"",secondSplitAddClass=lap.splits[1]===bestSecondSplitAll?"bestLapAll":lap.splits[1]===bestSecondSplit?"bestLap":"",thirdSplitAddClass=lap.splits[2]===bestThirdSplitAll?"bestLapAll":lap.splits[2]===bestThirdSplit?"bestLap":"";lapTableHtml+=`<div class="lapTableLine${lap.isValidForBest?"":" noValidLap"}">\n                <div class="lap">${number+1}</div>\n                <div class="laptime ${laptimeAddClass}">${getTime(lap.laptime)}</div>\n                <div class="splits">\n                    <div class="laptime ${firstSplitAddClass}">${getTime(lap.splits[0])}</div>\n                    <div class="laptime ${secondSplitAddClass}">${getTime(lap.splits[1])}</div>\n                    <div class="laptime ${thirdSplitAddClass}">${getTime(lap.splits[2])}</div>\n                </div>\n            </div>`}),lapsElem.innerHTML=lapTableHtml,timetable.insertBefore(lapsElem,elem.nextElementSibling)}function getTime(total){if(!total)return"--:--.---";const millis=total%1e3,seconds=(total-millis)/1e3%60,minutes=((total-millis)/1e3-seconds)/60%60;return`${pad(minutes,2)}:${pad(seconds,2)}.${pad(millis,3)}`}function pad(num,size){const s="0".repeat(size-1)+num;return s.substr(s.length-size)}resultElems.forEach((elem,index)=>{elem.addEventListener("click",ev=>renderTimetable(ev,elem,index))});