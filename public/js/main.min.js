"use strict";(()=>{const e={addSessionButton:document.getElementById("addSession"),sessionsWrapper:document.getElementById("sessions"),sessions:document.getElementsByClassName("session"),saveButton:document.getElementById("save"),restartButton:document.getElementById("restart"),startButton:document.getElementById("start"),stopButton:document.getElementById("stop"),status:document.getElementById("status"),logs:document.getElementById("logs"),showPasswordButtons:document.getElementsByClassName("showPassword")},t={serverName:document.getElementById("serverName"),password:document.getElementById("password"),adminPassword:document.getElementById("adminPassword"),spectatorPassword:document.getElementById("spectatorPassword"),centralEntryListPath:document.getElementById("centralEntryListPath"),carGroup:document.getElementById("carGroup"),maxCarSlots:document.getElementById("maxCarSlots"),trackMedalsRequirement:document.getElementById("trackMedalsRequirement"),safetyRatingRequirement:document.getElementById("safetyRatingRequirement"),racecraftRatingRequirement:document.getElementById("racecraftRatingRequirement"),maxConnections:document.getElementById("maxConnections"),udpPort:document.getElementById("udpPort"),tcpPort:document.getElementById("tcpPort"),registerToLobby:document.getElementById("registerToLobby"),isRaceLocked:document.getElementById("isRaceLocked"),shortFormationLap:document.getElementById("shortFormationLap"),dumpLeaderboards:document.getElementById("dumpLeaderboards"),dumpEntryList:document.getElementById("dumpEntryList"),randomizeTrackWhenEmpty:document.getElementById("randomizeTrackWhenEmpty"),allowAutoDQ:document.getElementById("allowAutoDQ"),formationLapType:document.getElementById("formationLapType"),track:document.getElementById("track"),preRaceWaitingTimeSeconds:document.getElementById("preRaceWaitingTimeSeconds"),sessionOverTimeSeconds:document.getElementById("sessionOverTimeSeconds"),postQualySeconds:document.getElementById("postQualySeconds"),postRaceSeconds:document.getElementById("postRaceSeconds"),pitWindowLengthSec:document.getElementById("pitWindowLengthSec"),driverStintTimeSec:document.getElementById("driverStintTimeSec"),mandatoryPitstopCount:document.getElementById("mandatoryPitstopCount"),maxTotalDrivingTime:document.getElementById("maxTotalDrivingTime"),maxDriversCount:document.getElementById("maxDriversCount"),isRefuellingAllowedInRace:document.getElementById("isRefuellingAllowedInRace"),isRefuellingTimeFixed:document.getElementById("isRefuellingTimeFixed"),isMandatoryPitstopRefuellingRequired:document.getElementById("isMandatoryPitstopRefuellingRequired"),isMandatoryPitstopTyreChangeRequired:document.getElementById("isMandatoryPitstopTyreChangeRequired"),isMandatoryPitstopSwapDriverRequired:document.getElementById("isMandatoryPitstopSwapDriverRequired"),ambientTemp:document.getElementById("ambientTemp"),cloudLevel:document.getElementById("cloudLevel"),rain:document.getElementById("rain"),weatherRandomness:document.getElementById("weatherRandomness"),disableIdealLine:document.getElementById("disableIdealLine"),disableAutosteer:document.getElementById("disableAutosteer"),disableAutoPitLimiter:document.getElementById("disableAutoPitLimiter"),disableAutoGear:document.getElementById("disableAutoGear"),disableAutoEngineStart:document.getElementById("disableAutoEngineStart"),disableAutoWiper:document.getElementById("disableAutoWiper"),disableAutoLights:document.getElementById("disableAutoLights"),disableAutoClutch:document.getElementById("disableAutoClutch"),stabilityControlLevelMax:document.getElementById("stabilityControlLevelMax")},s=Array.from(e.sessions);function n(t){t.getElementsByClassName("moveUpSession")[0].addEventListener("click",s=>{const n=t.previousElementSibling;e.sessionsWrapper.insertBefore(t,n)}),t.getElementsByClassName("moveDownSession")[0].addEventListener("click",s=>{const n=t.nextElementSibling;n?e.sessionsWrapper.insertBefore(t,n.nextElementSibling):e.sessionsWrapper.insertBefore(t,e.sessionsWrapper.firstChild)}),t.getElementsByClassName("removeSession")[0].addEventListener("click",s=>{e.sessionsWrapper.removeChild(t)})}e.addSessionButton.addEventListener("click",t=>{const s=e.sessions[0].cloneNode(!0);n(s),e.sessionsWrapper.append(s)}),s.forEach(e=>{n(e)}),Array.from(e.showPasswordButtons).forEach(e=>{e.addEventListener("click",s=>{const n=t[e.getAttribute("data-id")].type;t[e.getAttribute("data-id")].type="password"===n?"text":"password"})}),e.saveButton.addEventListener("click",s=>{document.body.style.cursor="progress",fetch("save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:{serverName:t.serverName.value,password:t.password.value,adminPassword:t.adminPassword.value,spectatorPassword:t.spectatorPassword.value,centralEntryListPath:t.centralEntryListPath.value,carGroup:t.carGroup.value,maxCarSlots:parseInt(t.maxCarSlots.value),trackMedalsRequirement:parseInt(t.trackMedalsRequirement.value),safetyRatingRequirement:parseInt(t.safetyRatingRequirement.value),racecraftRatingRequirement:parseInt(t.racecraftRatingRequirement.value),isRaceLocked:!0===t.isRaceLocked.checked?1:0,shortFormationLap:!0===t.shortFormationLap.checked?1:0,dumpLeaderboards:!0===t.dumpLeaderboards.checked?1:0,dumpEntryList:!0===t.dumpEntryList.checked?1:0,randomizeTrackWhenEmpty:!0===t.randomizeTrackWhenEmpty.checked?1:0,allowAutoDQ:!0===t.allowAutoDQ.checked?1:0,formationLapType:parseInt(t.formationLapType.value)},event:{track:t.track.value,preRaceWaitingTimeSeconds:parseInt(t.preRaceWaitingTimeSeconds.value),sessionOverTimeSeconds:parseInt(t.sessionOverTimeSeconds.value),postQualySeconds:parseInt(t.postQualySeconds.value),postRaceSeconds:parseInt(t.postRaceSeconds.value),ambientTemp:parseInt(t.ambientTemp.value),cloudLevel:parseFloat(t.cloudLevel.value),rain:parseFloat(t.rain.value),weatherRandomness:parseInt(t.weatherRandomness.value),sessions:Array.from(e.sessions).map(e=>({sessionType:e.getElementsByClassName("sessionType")[0].value,dayOfWeekend:parseInt(e.getElementsByClassName("dayOfWeekend")[0].value),hourOfDay:parseInt(e.getElementsByClassName("hourOfDay")[0].value),timeMultiplier:parseInt(e.getElementsByClassName("timeMultiplier")[0].value),sessionDurationMinutes:parseInt(e.getElementsByClassName("sessionDurationMinutes")[0].value)}))},eventRules:{pitWindowLengthSec:parseInt(t.pitWindowLengthSec.value),driverStintTimeSec:parseInt(t.driverStintTimeSec.value),mandatoryPitstopCount:parseInt(t.mandatoryPitstopCount.value),maxTotalDrivingTime:parseInt(t.maxTotalDrivingTime.value),maxDriversCount:parseInt(t.maxDriversCount.value),isRefuellingAllowedInRace:!0===t.isRefuellingAllowedInRace.checked?1:0,isRefuellingTimeFixed:!0===t.isRefuellingTimeFixed.checked?1:0,isMandatoryPitstopRefuellingRequired:!0===t.isMandatoryPitstopRefuellingRequired.checked?1:0,isMandatoryPitstopTyreChangeRequired:!0===t.isMandatoryPitstopTyreChangeRequired.checked?1:0,isMandatoryPitstopSwapDriverRequired:!0===t.isMandatoryPitstopSwapDriverRequired.checked?1:0},assistRules:{disableIdealLine:!1===t.disableIdealLine.checked?1:0,disableAutosteer:!1===t.disableAutosteer.checked?1:0,disableAutoPitLimiter:!1===t.disableAutoPitLimiter.checked?1:0,disableAutoGear:!1===t.disableAutoGear.checked?1:0,disableAutoEngineStart:!1===t.disableAutoEngineStart.checked?1:0,disableAutoWiper:!1===t.disableAutoWiper.checked?1:0,disableAutoLights:!1===t.disableAutoLights.checked?1:0,disableAutoClutch:!1===t.disableAutoClutch.checked?1:0,stabilityControlLevelMax:parseInt(t.stabilityControlLevelMax.value)},configuration:{registerToLobby:!0===t.registerToLobby.checked?1:0,maxConnections:parseInt(t.maxConnections.value),udpPort:parseInt(t.udpPort.value),tcpPort:parseInt(t.tcpPort.value)}})}).then(()=>{setTimeout(()=>{document.body.style.cursor="default",window.location.href="/"},500)}).catch(console.error)}),e.restartButton.addEventListener("click",t=>{document.body.style.cursor="progress",e.restartButton.classList.add("active"),fetch("/service/restart").then(()=>{document.body.style.cursor="default",e.restartButton.classList.remove("active")})}),e.startButton.addEventListener("click",t=>{document.body.style.cursor="progress",e.startButton.classList.add("active"),fetch("/service/start").then(()=>{document.body.style.cursor="default",e.startButton.classList.remove("active")})}),e.stopButton.addEventListener("click",t=>{document.body.style.cursor="progress",e.stopButton.classList.add("active"),fetch("/service/stop").then(()=>{document.body.style.cursor="default",e.stopButton.classList.remove("active")})});const a=()=>{e.status.style.color="var(--font-dark-clr)",fetch("/service/status").then(e=>e.text()).then(t=>{t&&(e.status.innerText=t,e.status.style.color="var(--font-clr)")}).catch(console.error)},o=()=>{e.logs.style.color="var(--font-dark-clr)",fetch("/service/log").then(e=>e.text()).then(t=>{if(!t)return;const s=e.logs.scrollTop==e.logs.scrollHeight-e.logs.offsetHeight;t=t.replace(/(==ERR:.*?<\/?br>)/g,'<span class="err">$1</span>').replace(/(systemd\[\d\]+:)(.*?<\/?br>)/g,'$1<span class="sys">$2</span>').replace(/(RegisterToLobby succeeded|Lobby accepted connection<\/?br>)/g,'<span class="suc">$1</span>'),e.logs.innerHTML=t,s&&(e.logs.scrollTop=e.logs.scrollHeight),e.logs.style.color="var(--font-clr)"}).catch(console.error)};a(),setInterval(a,5e3),o(),setInterval(o,1e4)})();